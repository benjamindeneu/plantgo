<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PlantGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- System UI stack with Roboto fallback -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome 6 (matches the fa-solid usage) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-T1jVgQ3..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0"></script>

  <!-- App CSS -->
  <link rel="stylesheet" href="css/styles.css">
  <!-- Optional: iOS PWA colors -->
  <meta name="theme-color" content="#55c86f">
</head>
<body>
  <!-- Header -->
  <header role="banner">
    <h1>PlantGo</h1>

    <div id="userInfo">
      <button id="userBtn" aria-haspopup="true" aria-expanded="false" aria-controls="userMenu">
        <span id="userName">User</span>
        <span id="userLevel" class="level-badge">
          Lv. <span id="levelNumber">1</span>
          <div id="levelProgressContainer">
            <div id="levelProgressBar"></div>
          </div>
        </span>
      </button>

      <div id="userMenu" role="menu" aria-labelledby="userBtn">
        <button id="plantDexBtn" role="menuitem">Herbarium</button>
        <button id="logoutBtn" role="menuitem">Logout</button>
      </div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- Validate / Camera -->
    <section class="general-validation" aria-labelledby="find-plant-title">
      <h2 id="find-plant-title" class="sr-only">Identify a plant</h2>

      <input type="file" accept="image/*" capture="environment" id="photoInput" multiple hidden />

      <button id="validateBtn" class="primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
          <path fill="currentColor" d="M10.5 2a.5.5 0 0 1 .5.5V3h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h2v-.5a.5.5 0 0 1 .5-.5h6Zm-2.5 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm0 1.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5Z"/>
        </svg>
        I found a plant!
      </button>

      <button id="submitBtn" class="secondary">Validate all photos</button>

      <div id="preview" class="preview-strip" aria-live="polite"></div>
      <div id="validationResult" aria-live="polite"></div>
    </section>

    <hr class="rule" />

    <!-- GPS / Missions -->
    <section class="gps-section" aria-labelledby="missions-title">
      <h2 id="missions-title" class="sr-only">Get location and missions</h2>
      <button id="getLocationBtn">
        <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
        Get Location &amp; Missions
      </button>
      <div id="locationInfo" aria-live="polite"></div>
    </section>

    <section aria-labelledby="suggestions-title">
      <h2 id="suggestions-title" class="sr-only">Missions</h2>
      <div id="suggestions"></div>
    </section>

    <div id="requestresult" aria-live="polite"></div>

    <hr class="rule" />

    <!-- Result Modal -->
    <div id="resultModal" class="modal" style="display:none;" aria-modal="true" role="dialog" aria-labelledby="result-title">
      <div class="modal-content">
        <button id="modalClose" class="close" aria-label="Close dialog">&times;</button>

        <div id="levelUp"></div>

        <div id="progressSection" class="progress-row">
          <span id="currentLevelText" class="level-badge">
            Lv. <span id="resultLevelNumber">1</span>
            <div id="resultLevelProgressContainer" class="progress-mini">
              <div id="resultLevelProgressBar"></div>
            </div>
          </span>
          <span id="nextLevelText" class="muted">Next Level</span>
        </div>

        <h2 id="result-title">Identification Results</h2>
        <div id="modalText"></div>
      </div>
    </div>

    <!-- Mission Details Modal -->
    <div id="missionModal" class="modal" style="display:none;" aria-modal="true" role="dialog" aria-labelledby="mission-title">
      <div class="modal-content">
        <button id="missionModalClose" class="close" aria-label="Close dialog">&times;</button>
        <h2 id="mission-title" class="sr-only">Mission Details</h2>
        <div id="missionModalText"></div>
      </div>
    </div>

    <!-- Spinner -->
    <div id="spinner" class="spinner" style="display:none;" aria-hidden="true"></div>

    <!-- Branding -->
    <div class="brand">
      <img src="https://my.plantnet.org/images/powered-by-plantnet-dark.svg" alt="Powered by Pl@ntNet" loading="lazy">
    </div>
  </main>

  <!-- JS -->
  <script type="module" src="js/main.js"></script>

  <!-- Tiny menu toggle (kept behavior) -->
  <script>
    window.addEventListener('beforeunload', function (e) {
      e.preventDefault();
      e.returnValue = '';
    });
    const userBtn = document.getElementById("userBtn");
    const userMenu = document.getElementById("userMenu");

    userBtn.addEventListener("click", function() {
      const open = userMenu.style.display === "block";
      userMenu.style.display = open ? "none" : "block";
      userBtn.setAttribute("aria-expanded", String(!open));
    });

    document.addEventListener("click", function(event) {
      if (!userBtn.contains(event.target) && !userMenu.contains(event.target)) {
        userMenu.style.display = "none";
        userBtn.setAttribute("aria-expanded", "false");
      }
    });
  </script>
</body>
</html>
